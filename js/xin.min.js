window.xin=function(){"use strict";var a={set:function(a,b){var c,d,e=this;if("xin."!==a.substr(0,4))throw new Error('Namespace not accepted, should be prefixed with "xin."');c=a.substr(4).split("."),d=c[c.length-1];for(var f in c){var g=c[f];e[g]=g===d?b:e[g]||{},e=e[g]}}};return window.jQuery?(a.when=jQuery.when,a.Deferred=jQuery.Deferred,a.$=jQuery):window.Zepto&&(Deferred.installInto(a),Zepto.Deferred||Deferred.installInto(Zepto),a.$=Zepto),window.Zepto&&(a.$.fn.detach=a.$.fn.remove),a.$.fn.serializeObject=function(){var b={};return _.each(a.$(this).serializeArray(),function(a){b[a.name]=a.value}),b},a}(),function(a){"use strict";var b=document.body,c=navigator.userAgent,d=~c.indexOf("iPhone")||~c.indexOf("iPod"),e=~c.indexOf("iPad"),f=d||e,g=window.navigator.standalone,h=~c.indexOf("Android"),i=0;a.set("xin.detect",{ua:c,iphone:d,ipad:e,ios:f,fullscreen:g,android:h}),h&&(window.onscroll=function(){b.style.height=window.innerHeight+"px"});var j=window.onload=function(){if(f){var a=document.documentElement.clientHeight;d&&!g&&(a+=60),b.style.height=a+"px"}else h&&(b.style.height=window.innerHeight+56+"px");setTimeout(scrollTo,0,0,1)};window.onresize=function(){var a=b.offsetWidth;i!=a&&(i=a,j())},window.onresize()}(window.xin),function(a){"use strict";var b=function(){this.initialize.apply(this,arguments)};_.extend(b.prototype,Backbone.Events,{initialize:function(b){var c=this;this.options=b=b||{},this.container=new a.IoC,this.router=b.router||new a.Router,this.router.app=this,this.directiveManager=new a.DirectiveManager(this),b.directives&&a.$.each(b.directives,function(a,b){c.directiveManager.put(a,b)}),this.$el=a.$(b.el),this.$el.addClass("xin-app").attr("data-role","app"),this.providerRepository=new a.ProviderRepository(this),a.app=a.app||this},remove:function(){this.$el.removeClass("xin-app").removeAttr("data-role")},start:function(){var b=this;this.catchAllHref(),a.when(this.providerRepository.initialize()).then(function(){return b.directiveManager.scan()}).done(function(){a.$("body").show(),"function"==typeof b.router.start?b.router.start():Backbone.history.start()})},catchAllHref:function(){this.$el.on("click","a",function(b){b.preventDefault();var c=a.$(this).attr("href");"/"===c[0]&&(c=location.origin+c),location.hash=c.split("#")[0]==location.href.split("#")[0]?"#_":"#"+c}),this.$el.on("submit","form",function(b){b.preventDefault(),a.$.ajax({url:a.$(this).attr("action"),method:a.$(this).attr("method"),data:a.$(this).serialize()}).done(function(a,b){alert(b)}).fail(function(a,b,c){alert(c)})})},set:function(){this.container.set.apply(this.container,arguments)},get:function(){return this.container.get.apply(this.container,arguments)},resolve:function(){return this.container.resolve.apply(this.container,arguments)},use:function(a){this.router.use(a)}}),a.set("xin.App",b)}(window.xin),function(a){"use strict";var b=function(){this.initialize.apply(this,arguments)};_.extend(b.prototype,{context:{},fallbackContext:null,initialize:function(a){a=a||{},this.fallbackContext=a.fallbackContext||window,this.aliases={app:"xin.Application",view:"xin.ui.Outlet",pager:"xin.ui.Pager",list:"xin.ui.List","list-item":"xin.ui.ListItem","list-empty":"xin.ui.ListEmpty"}},clear:function(){this.context={},this.context.prototype=this.fallbackContext},get:function(a){var b,c=a.split("."),d=this.context;return d=this.context,(b=_.every(c,function(a){return d=d[a]||void 0,void 0!==d}))?d:(d=this.fallbackContext,b=_.every(c,function(a){return d=d[a]||void 0,void 0!==d}),b?d:void 0)},set:function(a,b){{var c=a.split("."),d=this.context,e=0;_.each(c,function(a){e++,e==c.length?d[a]=b:(d[a]||(d[a]={}),d=d[a])})}},createObject:function(b){var c,d=a.Deferred(),e=[];for(var f in arguments)e.push(arguments[f]);switch(e=e.slice(1),e.length){case 0:c=new b;break;case 1:c=new b(e[0]);break;case 2:c=new b(e[0],e[1]);break;case 3:c=new b(e[0],e[1],e[2]);break;case 4:c=new b(e[0],e[1],e[2],e[3]);break;case 5:c=new b(e[0],e[1],e[2],e[3],e[4])}return d.resolve(c),d.promise()},resolve:function(c){var d;do this.aliases[c]?(c=this.aliases[c],d=!0):d=!1;while(d);var e,f,g,h="",i=a.Deferred(),j=[];if(!c)return i.reject(new Error("Key not found or cannot resolve!")).promise();for(var k in arguments)j.push(arguments[k]);if("function"==typeof c)this.createObject.apply(this,j).then(i.resolve,i.reject);else if("string"==typeof c)if(e=c.indexOf(":"),e>=0&&(h=c.substr(0,e),c=c.substr(e+1)),h)try{f=b.getResolver(h),j[0]=c,f.apply(this,j).then(i.resolve,i.reject)}catch(l){i.resolve(c)}else if(g=this.get(c),"function"==typeof g){var m=_.last(c.split("."))[0];m.toUpperCase()==m?(j[0]=g,this.createObject.apply(this,j).then(i.resolve,i.reject)):i.resolve(g.apply(void 0,j.slice(1)))}else i.resolve(g);else i.resolve(c);return i.promise()}}),_.extend(b,{resolvers:{xhr:function(b){return a.$.get(b).then(null,function(b,c,d){return a.Deferred().reject(new Error(d)).promise()}).promise()},template:function(c){var d=b.getResolver("xhr");return d(c).then(function(b){return a.Deferred().resolve(_.template(b))},null)},model:function(a){return this.resolve(a)},collection:function(a){return this.resolve(a)}},addResolver:function(a,b){this.resolvers[a]=b},getResolver:function(a){var b=this.resolvers[a];if("function"==typeof b)return b;if("object"==typeof b&&"function"==typeof b.resolve)return b.resolve;throw new Error("IoC Resolver ["+a+"] not found!")}}),a.set("xin.IoC",b)}(window.xin),function(a){"use strict";var b=function(){this.middlewares=[],Backbone.Router.apply(this,arguments)};_.extend(b.prototype,Backbone.Router.prototype,{start:function(){this.setDefaultRoute(),Backbone.history.start()},setDefaultRoute:function(){Backbone.history.handlers.push({route:/^(.*?)$/,callback:_.bind(this.options&&this.options.routeMissing||this.routeMissing,this)})},registerView:function(a,b){this.viewRoutes[a]=b,(!this.viewDefaultRoute||b.data("uri-default"))&&(this.viewDefaultRoute=a)},routeMissing:function(b){var c=this,d=c.viewRoutes[b];d||"_"!=b||(d=a.$(".xin-app .xin-view"),c.viewDefaultRoute="_",d.attr("data-uri","_"),this.registerView("_",d)),""===b?(c.viewDefaultRoute||(d=a.$(".xin-app .xin-view"),c.viewDefaultRoute="_",d.attr("data-uri","_"),this.registerView("_",d)),location.hash=c.viewDefaultRoute):d?a.ui.show(d.data("instance")):a.$.get(b).done(function(d){d=d.trim(),d.indexOf("<body")>=0?(d=d.substr(d.indexOf("<body")+1),d="<div>"+d.substr(d.indexOf(">")+1)+"</div>"):d.indexOf("<BODY")>=0?(d=d.substr(d.indexOf("<BODY")+1),d="<div>"+d.substr(d.indexOf(">")+1)+"</div>"):d="<div>"+d+"</div>";var e=a.$(d);e.find("[data-role]").length>0?e=e.find("[data-role]"):e.find("body").length>0&&(e=e.find("body")),d=e.html()||"";var f=a.$('<div data-role="view" data-uri="'+b+'">'+d+"</div>");c.mainViewport.append(f),a.when(c.app.directiveManager.scan()).done(function(){c.routeMissing(b)})}).fail(function(){console.error('Missing route for URI: "'+b+'"')})},show:function(a){a&&("function"==typeof a.show?a.show():a.$el.addClass("hz-show"))},route:function(a){var b,c=[],d=this;if(arguments.length>1)for(var e=1;e<arguments.length;e++)c.push(b=arguments[e]);Backbone.Router.prototype.route.call(this,a,function(){var a=arguments;d.runMiddleware.call(d,b.options||{}).done(function(){b.apply(d,a)})})},use:function(a){a.app=this.app,this.middlewares.push(a)},runMiddleware:function(b){var c=(this.app,null);return _.each(this.middlewares,function(a){c=c?c.then(function(){return a.call(b)}):a.call(b)}),c||(c=a.Deferred().resolve().promise()),c}}),a.set("xin.Router",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a,this.directives={}};_.extend(b.prototype,{put:function(a,b){if(!b)throw new Error('Directive for "'+a+'" not found or invalid!');if("function"==typeof b){var c=b;b=new c(this.app)}this.directives[a]=b},scan:function(b){var c,d=this,e=[],f=new a.Deferred,g=function(){e=[],b.children().each(function(){var b=a.$(this);e.push(d.scan(b))}),a.$.when.apply(null,e).done(function(){f.resolve()})},h=function(c){return function(d){return d?(g(),a.Deferred().reject().promise()):c.run(b)}};return b=b||this.app.$el,_.each(this.directives,function(a){a.matcher(b)&&(c=c?c.then(h(a)):a.run(b))}),c||(c=a.Deferred().resolve().promise()),c.done(g),f.promise()}}),a.set("xin.DirectiveManager",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a,this.providers=[]};_.extend(b.prototype,{add:function(a){if(!a)throw new Error("Provider not found or invalid!");if("function"==typeof a){var b=a;a=new b}this.providers.push(a)},initialize:function(){var b=this.app,c=null;return _.each(this.providers,function(a){c=c?c.then(function(){return a.initialize(b)}):a.initialize(b)}),c||(c=a.Deferred().resolve().promise()),c}}),a.set("xin.ProviderRepository",b)}(window.xin),function(a){var b=function(a,b){this.$el=a,this.to=b,this.timeout=.3};_.extend(b.prototype,{play:function(){var b=this,c=a.Deferred();this.$el.on("webkitTransitionEnd",function(){b.$el.off("webkitTransitionEnd"),b.$el.css("-webkit-transition",""),c.resolve()});var d="100%";return"right"==this.to&&(d="-"+d),this.$el.css("-webkit-transform","translate3d("+d+", 0, 0)"),this.$el.css("-webkit-transition","all "+b.timeout+"s"),b.$el.addClass("xin-show"),setTimeout(function(){b.$el.css("-webkit-transform","translate3d(0, 0, 0)")},a.fx.defaultOptions.delay),c.promise()}});var c=function(a,b){this.$el=a,this.to=b,this.timeout=.3};_.extend(c.prototype,{play:function(){var b=this,c=a.Deferred();return this.$el.on("webkitTransitionEnd",function(){b.$el.off("webkitTransitionEnd"),b.$el.removeClass("xin-show"),b.$el.css("-webkit-transition",""),c.resolve()}),this.$el.css("-webkit-transform","translate3d(0, 0, 0)"),this.$el.css("-webkit-transition","all "+b.timeout+"s"),setTimeout(function(){var a="100%";"left"==b.to&&(a="-"+a),b.$el.css("-webkit-transform","translate3d("+a+", 0, 0)")},a.fx.defaultOptions.delay),c.promise()}}),a.set("xin.fx",{defaultOptions:{delay:300},SlideIn:b,SlideOut:c})}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{matcher:function(a){return a.data("role")&&"app"===a.data("role").toLowerCase()},run:function(b){var c=a.Deferred();return b.attr("instantiated",!0).addClass("xin-role").data("instance",this.app),c.resolve(),c.promise()}}),a.set("xin.directive.AppDirective",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{matcher:function(a){return a.data("role")&&"app"!==a.data("role").toLowerCase()?!0:void 0},run:function(b){var c,d,e=[],f=new a.Deferred,g=this.app;return b.data("instantiated")?f.resolve().promise():(c=_.defaults(b.data(),{el:b,app:g}),d=c.role,_.each(c,function(a,b){if("string"==typeof a){a=b+":"+a;var d=g.resolve(a).then(function(a){c[b]=a});e.push(d)}}),a.$.when.apply(null,e).done(function(){g.resolve(d,c).done(function(a){if(!a)throw new Error('Role: "'+d+'" undefined');var b,c=a.$el;if(c&&(b=c.parent(".xin-role"),c.attr("data-instantiated",!0).data("instance",a).attr("data-cid",a.cid),b.length)){var e=b.data("instance");e.addChild&&e.addChild(a)}a instanceof Backbone.View&&(a.app=a.options.app,a.$el.addClass("xin-role"),a.isContainer||a.$el.addClass("xin-view"),a.render()),f.resolve()}).fail(function(){console.log(arguments)})}),f.promise())}}),a.set("xin.directive.RoleDirective",b)}(window.xin),function(a){var b=function(a){this.app=a,this.router=a.router,this.router.viewRoutes=a.router.viewRoutes||{},this.router.viewDefaultRoute=null};_.extend(b.prototype,{matcher:function(a){return a.data("uri")},run:function(b){var c=a.Deferred(),d=b.data("uri");return this.router.registerView(d,b),c.resolve().promise()}}),a.set("xin.directive.URIDirective",b)}(window.xin),function(a){"use strict";var b=function(a){this.app=a};_.extend(b.prototype,{newRef:function(){return this.ref=this.ref||0,"bind-"+this.ref++},matcher:function(a){return a.data("bind")},run:function(b){var c=a.Deferred(),d=(this.app,this),e=b.hasClass("xin-role")?b:b.parents(".xin-role"),f=e.data("instance"),g=b.data("bind").trim().split(/\s+/);return _.each(g,function(a){var c,e,g;a=a.split(":"),a.length>1&&(c=a[0],g=a[1],g=f[g]||d.app.get(g),_.isFunction(g)&&(e=d.newRef(),b.attr("data-bind-ref",e),g=_.bind(g,f),f.$el.on(c,"[data-bind-ref="+e+"]",g)))}),c.resolve(),c.promise()}}),a.set("xin.directive.BindDirective",b)}(window.xin),function(a){"use strict";var b=Backbone.View.extend({initialize:function(a){this.options=a,this.template=a.template||null},render:function(){return this.template&&this.$el.html(this.template(this)),this}});a.set("xin.ui.Outlet",b),_.extend(a.ui,{show:function(a){_.defer(function(){a.parent&&a.parent.showChild?a.parent.showChild(a).done(function(){a.$el[0].scrollTop=0,a.$el.addClass("xin-show")}):a.$el.addClass("xin-show")})}})}(window.xin),function(a){"use strict";var b=a.ui.Outlet.extend({isContainer:!0,initialize:function(a){this.constructor.__super__.initialize.apply(this,arguments),this.transition=a.transition||"plain",this.activePage=null,this.pages={},(!a.app.router.mainViewport||a.mainViewport)&&(a.app.router.mainViewport=this.$el),this.$el.addClass("xin-pager")},addChild:function(a){var b={};return b[a.cid]=a,_.extend(this.pages,b),this.pageKeys=_.keys(this.pages),this.pageValues=_.values(this.pages),a.parent=this,this},showChild:function(b){var c=-1,d=-1,e=a.Deferred();return this.activePage==b?e.resolve().promise():(b&&(c=_.indexOf(this.pageValues,b)),this.activePage&&(d=_.indexOf(this.pageValues,this.activePage)),this.$el.scrollTop(0),a.ui.Pager.transitions[this.transition](this,b,this.activePage,d-c).done(e.resolve),this.activePage=b,e.promise())}});_.extend(b,{transitions:{plain:function(b,c,d){var e=a.Deferred();return d&&d.$el.removeClass("xin-show"),c.$el.addClass("xin-show"),e.resolve(),e.promise()},slide:function(b,c,d,e){var f,g,h,i=a.Deferred();return f=0>e?"left":"right",c&&(g=new a.fx.SlideIn(c.$el,f)),d&&(h=new a.fx.SlideOut(d.$el,f)),g&&g.play(),h&&h.play().then(function(){a.$(this).removeClass("xin-show"),_.defer(i.resolve)}),i.promise()}}}),a.set("xin.ui.Pager",b)}(window.xin);